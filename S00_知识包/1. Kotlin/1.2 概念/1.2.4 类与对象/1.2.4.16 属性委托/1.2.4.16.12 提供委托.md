
## ğŸ æä¾›å§”æ‰˜

#### ğŸ”§ é€šè¿‡å®šä¹‰ `provideDelegate` æ“ä½œç¬¦ï¼Œå¯ä»¥æ‰©å±•åˆ›å»ºå±æ€§å®ç°æ‰€å§”æ‰˜å¯¹è±¡çš„é€»è¾‘ã€‚

ğŸ”„ å¦‚æœ `by` å³ä¾§æ‰€ä½¿ç”¨çš„å¯¹è±¡å°† `provideDelegate` å®šä¹‰ä¸ºæˆå‘˜æˆ–æ‰©å±•å‡½æ•°ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨è¯¥å‡½æ•°æ¥åˆ›å»ºå±æ€§å§”æ‰˜å®ä¾‹ã€‚

ğŸ” `provideDelegate` çš„ä¸€ä¸ªå¯èƒ½ç”¨ä¾‹æ˜¯åœ¨å±æ€§åˆå§‹åŒ–æ—¶æ£€æŸ¥å…¶ä¸€è‡´æ€§ã€‚

#### ğŸŒŸ ä¾‹å¦‚ï¼Œå¦‚éœ€åœ¨ç»‘å®šä¹‹å‰æ£€æµ‹å±æ€§åç§°ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š

```kotlin
class ResourceDelegate<T> : ReadOnlyProperty<MyUI, T> {
    override fun getValue(thisRef: MyUI, property: KProperty<*>): T { ... }
}

class ResourceLoader<T>(id: ResourceID<T>) {
    operator fun provideDelegate(
            thisRef: MyUI,
            prop: KProperty<*>
    ): ReadOnlyProperty<MyUI, T> {
        checkProperty(thisRef, prop.name)
        // åˆ›å»ºå§”æ‰˜
        return ResourceDelegate()
    }

    private fun checkProperty(thisRef: MyUI, name: String) { â€¦â€¦ }
}

class MyUI {
    fun <T> bindResource(id: ResourceID<T>): ResourceLoader<T> { â€¦â€¦ }

    val image by bindResource(ResourceID.image_id)
    val text by bindResource(ResourceID.text_id)
}
```
#### ğŸ” `provideDelegate` çš„å‚æ•°ä¸ `getValue` çš„ç›¸åŒï¼š

* ğŸ¯ `thisRef` å¿…é¡»ä¸ _å±æ€§æ‰€æœ‰è€…_ ç±»å‹ï¼ˆå¯¹äºæ‰©å±•å±æ€§å¿…é¡»æ˜¯è¢«æ‰©å±•çš„ç±»å‹ï¼‰ç›¸åŒæˆ–è€…æ˜¯å®ƒçš„è¶…ç±»å‹ï¼›
* ğŸ”‘ `property` å¿…é¡»æ˜¯ç±»å‹ `KProperty<*>` æˆ–å…¶è¶…ç±»å‹ã€‚

ğŸ—ï¸ åœ¨åˆ›å»º `MyUI` å®ä¾‹æœŸé—´ï¼Œä¸ºæ¯ä¸ªå±æ€§è°ƒç”¨ `provideDelegate` æ–¹æ³•ï¼Œå¹¶ç«‹å³æ‰§è¡Œå¿…è¦çš„éªŒè¯ã€‚

#### ğŸš« å¦‚æœæ²¡æœ‰è¿™ç§æ‹¦æˆªå±æ€§ä¸å…¶å§”æ‰˜ä¹‹é—´çš„ç»‘å®šçš„èƒ½åŠ›ï¼Œä¸ºäº†å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œä½ å¿…é¡»æ˜¾å¼ä¼ é€’å±æ€§åï¼Œè¿™ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼š

```kotlin
// æ£€æµ‹å±æ€§åç§°è€Œä¸ä½¿ç”¨â€œprovideDelegateâ€åŠŸèƒ½
class MyUI {
    val image by bindResource(ResourceID.image_id, "image")
    val text by bindResource(ResourceID.text_id, "text")
}

fun <T> MyUI.bindResource(
        id: ResourceID<T>,
        propertyName: String
): ReadOnlyProperty<MyUI, T> {
    checkProperty(this, propertyName)
   // åˆ›å»ºå§”æ‰˜
}
```

ğŸ­ åœ¨ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œä¼šè°ƒç”¨ `provideDelegate` æ–¹æ³•æ¥åˆå§‹åŒ–è¾…åŠ©çš„ `prop$delegate` å±æ€§ã€‚

#### ğŸ”„ æ¯”è¾ƒå¯¹äºå±æ€§å£°æ˜ `val prop: Type by MyDelegate()` ç”Ÿæˆçš„ä»£ç ä¸`ä¸Šé¢`ï¼ˆå½“ `provideDelegate` æ–¹æ³•ä¸å­˜åœ¨æ—¶ï¼‰ç”Ÿæˆçš„ä»£ç ï¼š

```kotlin
class C {
    var prop: Type by MyDelegate()
}

// è¿™æ®µä»£ç æ˜¯å½“â€œprovideDelegateâ€åŠŸèƒ½å¯ç”¨æ—¶
// ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ï¼š
class C {
    // è°ƒç”¨â€œprovideDelegateâ€æ¥åˆ›å»ºé¢å¤–çš„â€œdelegateâ€å±æ€§
    private val prop$delegate = MyDelegate().provideDelegate(this, this::prop)
    var prop: Type
        get() = prop$delegate.getValue(this, this::prop)
        set(value: Type) = prop$delegate.setValue(this, this::prop, value)
}
```

ğŸ”” è¯·æ³¨æ„ï¼Œ`provideDelegate` æ–¹æ³•åªå½±å“è¾…åŠ©å±æ€§çš„åˆ›å»ºï¼Œå¹¶ä¸ä¼šå½±å“ä¸º getter æˆ– setter ç”Ÿæˆçš„ä»£ç ã€‚

#### ğŸ› ï¸ ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„ `PropertyDelegateProvider` æ¥å£ï¼Œä½ å¯ä»¥åˆ›å»ºå§”æ‰˜æä¾›è€…è€Œæ— éœ€åˆ›å»ºæ–°çš„ç±»ã€‚

```kotlin
val provider = PropertyDelegateProvider { thisRef: Any?, property ->
    ReadOnlyProperty<Any?, Int> {_, property -> 42 }
}
val delegate: Int by provider
```