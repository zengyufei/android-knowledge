### ğŸ”„ Java ä¸­çš„æ³›å‹ä¸é€šé…ç¬¦

### æ³›å‹çš„ä¸Šç•Œé€šé…ç¬¦

å› ä¸º Java çš„æ³›å‹æœ¬èº«å…·æœ‰ã€Œä¸å¯å˜æ€§ Invarianceã€ï¼Œæ‰€ä»¥å³ä½¿ `Fruit` ç±»æ˜¯ `Apple` ç±»çš„çˆ¶ç±»ï¼Œä½† Java é‡Œé¢è®¤ä¸º `List<Fruit>` å’Œ `List<Apple>` ç±»å‹å¹¶ä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»çš„æ³›å‹ `List<Apple>` ä¸å±äºæ³›å‹ `List<Fruit>` çš„å­ç±»ã€‚

#### æ‰€ä»¥è¿™æ ·çš„ä»£ç å¹¶ä¸è¢«è¿è¡Œ:

```java
List<Apple> apples = new ArrayList<Apple>();
List<Fruit> fruits = apples;  
// ğŸ‘† å¤šæ€ç”¨åœ¨è¿™é‡Œä¼šæŠ¥é”™ Required type:List<Fruit> Provided: List<Apple>
```

ğŸš« é‚£å‡å¦‚æˆ‘ä»¬æƒ³çªç ´è¿™å±‚é™åˆ¶ï¼Œæ€ä¹ˆåŠï¼Ÿ

ä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦ `? extends` ï¼š

```java
List<Apple> apples = new ArrayList<Apple>();
List<? extends Fruit> fruits = apples;
// ğŸ‘†ä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦åï¼Œç¼–è¯‘ä¸å†æŠ¥é”™
```

ã€Œä¸Šç•Œé€šé…ç¬¦ã€ï¼Œå¯ä»¥ä½¿ Java æ³›å‹å…·æœ‰ã€Œåå˜æ€§ Covarianceã€ï¼Œåå˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„ã€‚

> åœ¨ç»§æ‰¿å…³ç³»æ ‘ä¸­ï¼Œå­ç±»ç»§æ‰¿è‡ªçˆ¶ç±»ï¼Œå¯ä»¥è®¤ä¸ºçˆ¶ç±»åœ¨ä¸Šï¼Œå­ç±»åœ¨ä¸‹ã€‚extends é™åˆ¶äº†æ³›å‹ç±»å‹çš„çˆ¶ç±»å‹ï¼Œæ‰€ä»¥å«ä¸Šç•Œã€‚
 
#### å®ƒæœ‰ä¸¤å±‚æ„æ€ï¼š

- å…¶ä¸­ `?` æ˜¯ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºè¿™ä¸ª `List` çš„æ³›å‹ç±»å‹æ˜¯ä¸€ä¸ªæœªçŸ¥ç±»å‹ã€‚

- `extends` é™åˆ¶äº†è¿™ä¸ªæœªçŸ¥ç±»å‹çš„ä¸Šç•Œï¼Œä¹Ÿå°±æ˜¯æ³›å‹ç±»å‹å¿…é¡»æ»¡è¶³è¿™ä¸ª `extends` çš„é™åˆ¶æ¡ä»¶ï¼Œè¿™é‡Œå’Œå®šä¹‰class çš„ `extends` å…³é”®å­—æœ‰ç‚¹ä¸ä¸€æ ·ï¼š

  - å®ƒçš„èŒƒå›´ä¸ä»…æ˜¯æ‰€æœ‰ç›´æ¥å’Œé—´æ¥å­ç±»ï¼Œè¿˜åŒ…æ‹¬ä¸Šç•Œå®šä¹‰çš„çˆ¶ç±»æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯ `Fruitã€‚`

  - å®ƒè¿˜æœ‰ `implements` çš„æ„æ€ï¼Œå³è¿™é‡Œçš„ä¸Šç•Œä¹Ÿå¯ä»¥æ˜¯ `interfaceã€‚`

è¿™ä¸ªçªç ´é™åˆ¶æœ‰æ„ä¹‰ä¹ˆï¼Ÿ

æœ‰çš„ã€‚

å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¥å£ `Fruit`ï¼š

```java
interface Fruit {
    float getWeight();
}
```

æœ‰ä¸¤ä¸ªæ°´æœç±»å®ç°äº† `Fruit` æ¥å£ï¼š

```java
class Banana implements Fruit {
    @Override
    public float getWeight() {
        return 0.5f;
    }
}

class Apple implements Fruit {
    @Override
    public float getWeight() {
        return 1f;
    }
}
```

å‡è®¾æˆ‘ä»¬æœ‰ä¸ªéœ€æ±‚æ˜¯éœ€è¦ç»™æ°´æœç§°é‡ï¼š

```java
List<Apple> apples = new ArrayList<>();
apples.add(new Apple());
float totalWeight = getTotalWeight(apples); 
// ğŸ‘† æŠ¥é”™ï¼šRequired type: List<Fruit> Provided: List<Apple>

private float getTotalWeight(List<Fruit> fruitList) {
    float totalWeight = 0;
    for (Fruit fruit : fruitList) {
        totalWeight += fruit.getWeight();
    }
    return totalWeight;
}
```

æƒ³æ¥è¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æ­£å¸¸çš„éœ€æ±‚ï¼Œç§¤å¯ä»¥ç§°å„ç§æ°´æœçš„é‡é‡ï¼Œä½†ä¹Ÿå¯ä»¥åªç§°è‹¹æœã€‚ä½ ä¸èƒ½å› ä¸ºæˆ‘åªä¹°è‹¹æœå°±ä¸ç»™æˆ‘ç§°é‡å§ã€‚

æ‰€ä»¥æŠŠä¸Šé¢çš„ä»£ç åŠ ä¸Šä¸Šç•Œé€šé…ç¬¦å°±å¯ä»¥å•¦ã€‚

```java
List<Apple> apples = new ArrayList<>();
apples.add(new Apple());
float totalWeight = getTotalWeight(apples); 
// ğŸ‘† ä¸å†æŠ¥é”™

// ğŸ‘‡ å¢åŠ äº†ä¸Šç•Œé€šé…ç¬¦ ? extends
private float getTotalWeight(List<? extends Fruit> fruitList) {
    float totalWeight = 0;
    for (Fruit fruit : fruitList) {
        totalWeight += fruit.getWeight();
    }
    return totalWeight;
}
```

ä¸è¿‡ï¼Œä¸Šé¢ä½¿ç”¨ `? extends` ä¸Šç•Œé€šé…ç¬¦çªç ´äº†ä¸€å±‚é™åˆ¶ï¼Œå´è¢«æ–½åŠ äº†å¦ä¸€å±‚é™åˆ¶ï¼šåªå¯è¾“å‡ºä¸å¯è¾“å…¥ã€‚

ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

æ¯”å¦‚ï¼š

```java
List<Apple> apples = new ArrayList<Apple>();
List<? extends Fruit> fruits = apples;
Fruit fruit = fruits.get(0);
fruits.add(new Apple());
// ğŸ‘† æŠ¥é”™ï¼šRequired type: capture of ? extends Fruit Provided: Apple
```

å£°æ˜äº†ä¸Šç•Œé€šé…ç¬¦æ³›å‹çš„é›†åˆï¼Œä¸å†å…è®¸ `add` æ–°çš„å¯¹è±¡ï¼Œ`Apple` `ä¸è¡Œï¼ŒFruit` ä¹Ÿä¸è¡Œã€‚æ‹“å±•å¼€æ¥è¯´ï¼šä¸æ­¢æ˜¯é›†åˆï¼Œè‡ªå·±ç¼–å†™ä¸€ä¸ªæ³›å‹åšè¾“å…¥ä¹Ÿä¸è¡Œã€‚

```java
interface Shop<T> {
    void showFruitName(T t);
    T getFruit();
}

Shop<? extends Fruit> apples = new Shop<Apple>(){
    @Override
    public void showFruitName(Apple apple) { }

    @Override
    public Apple getFruit() {
        return null;
    }
};
apples.getFruit();
apples.showFruitName(new Apple());
// ğŸ‘† æŠ¥é”™ï¼šRequired type: capture of ? extends Fruit Provided: Apple
```


### æ³›å‹çš„ä¸‹ç•Œé€šé…ç¬¦

ä¸ä¸Šç•Œé€šé…ç¬¦ `? extends` å¯¹åº”çš„å°±æ˜¯ä¸‹ç•Œé€šé…ç¬¦ `? super`


#### ä¸‹ç•Œé€šé…ç¬¦ `? super` æ‰€æœ‰æƒ…å†µå’Œ `? extends` ä¸Šç•Œé€šé…ç¬¦åˆšåˆšç›¸åï¼š

- é€šé…ç¬¦ `?` è¡¨ç¤º `List` çš„æ³›å‹ç±»å‹æ˜¯ä¸€ä¸ª æœªçŸ¥ç±»å‹ã€‚

- `super` é™åˆ¶äº†è¿™ä¸ªæœªçŸ¥ç±»å‹çš„ä¸‹ç•Œï¼Œä¹Ÿå°±æ˜¯æ³›å‹ç±»å‹å¿…é¡»æ»¡è¶³è¿™ä¸ª `super` çš„é™åˆ¶æ¡ä»¶

  - å®ƒçš„èŒƒå›´ä¸ä»…æ˜¯æ‰€æœ‰ç›´æ¥å’Œé—´æ¥å­çˆ¶ç±»ï¼Œè¿˜åŒ…æ‹¬ä¸‹ç•Œå®šä¹‰çš„å­ç±»æœ¬èº«ã€‚

  - `super` åŒæ ·æ”¯æŒ `interfaceã€‚`

#### å®ƒè¢«æ–½åŠ çš„æ–°é™åˆ¶æ˜¯ï¼šåªå¯è¾“å…¥ä¸å¯è¾“å‡ºã€‚

```java
Shop<? super Apple> apples = new Shop<Fruit>(){
    @Override
    public void showFruitName(Fruit apple) { }

    @Override
    public Fruit getFruit() {
        return null;
    }
};
apples.showFruitName(new Apple());
Apple apple = apples.getFruit();
 // ğŸ‘† æŠ¥é”™ï¼šRequired type: Apple Provided: capture of ? super Apple
```

è§£é‡Šä¸‹ï¼Œé¦–å…ˆ `?` è¡¨ç¤ºæœªçŸ¥ç±»å‹ï¼Œç¼–è¯‘å™¨æ˜¯ä¸ç¡®å®šå®ƒçš„ç±»å‹çš„ã€‚

è™½ç„¶ä¸çŸ¥é“å®ƒçš„å…·ä½“ç±»å‹ï¼Œä¸è¿‡åœ¨ Java é‡Œä»»ä½•å¯¹è±¡éƒ½æ˜¯ `Object` çš„å­ç±»ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½æŠŠ `apples.getFruit()` è·å–å‡ºæ¥çš„å¯¹è±¡èµ‹å€¼ç»™ `Object`ã€‚ç”±äºç±»å‹æœªçŸ¥ï¼Œæ‰€ä»¥ç›´æ¥èµ‹å€¼ç»™ä¸€ä¸ª `Apple` å¯¹è±¡è‚¯å®šæ˜¯ä¸è´Ÿè´£ä»»çš„ï¼Œéœ€è¦æˆ‘ä»¬åšä¸€å±‚å¼ºåˆ¶è½¬æ¢ï¼Œä¸è¿‡å¼ºåˆ¶è½¬æ¢æœ¬èº«å¯èƒ½å‘ç”Ÿé”™è¯¯ã€‚

è€Œ `Apple` å¯¹è±¡ä¸€å®šæ˜¯è¿™ä¸ªæœªçŸ¥ç±»å‹çš„å­ç±»å‹ï¼Œæ ¹æ®å¤šæ€çš„ç‰¹æ€§ï¼Œè¿™é‡Œé€šè¿‡ `showFruitName` è¾“å…¥ `Button` å¯¹è±¡æ˜¯åˆæ³•çš„ã€‚

#### å°ç»“ä¸‹ï¼ŒJava çš„æ³›å‹æœ¬èº«æ˜¯ä¸æ”¯æŒåå˜å’Œé€†å˜çš„ï¼š

- å¯ä»¥ä½¿ç”¨æ³›å‹é€šé…ç¬¦ `? extends` æ¥ä½¿æ³›å‹æ”¯æŒåå˜ï¼Œä½†æ˜¯ã€Œåªèƒ½è¯»å–ä¸èƒ½ä¿®æ”¹ã€ï¼Œè¿™é‡Œçš„ä¿®æ”¹ä»…æŒ‡å¯¹æ³›å‹é›†åˆæ·»åŠ å…ƒç´ ï¼Œå¦‚æœæ˜¯ `remove(int index)` ä»¥åŠ `clear` å½“ç„¶æ˜¯å¯ä»¥çš„ã€‚

- å¯ä»¥ä½¿ç”¨æ³›å‹é€šé…ç¬¦ `? super` æ¥ä½¿æ³›å‹æ”¯æŒé€†å˜ï¼Œä½†æ˜¯ã€Œåªèƒ½ä¿®æ”¹ä¸èƒ½è¯»å–ã€ï¼Œè¿™é‡Œè¯´çš„ä¸èƒ½è¯»å–æ˜¯æŒ‡ä¸èƒ½æŒ‰ç…§æ³›å‹ç±»å‹è¯»å–ï¼Œä½ å¦‚æœæŒ‰ç…§ `Object` è¯»å‡ºæ¥å†å¼ºè½¬å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

ç†è§£äº† Java çš„æ³›å‹ä¹‹åï¼Œå†ç†è§£ Kotlin ä¸­çš„æ³›å‹ï¼Œå°±æ¯”è¾ƒå®¹æ˜“äº†ã€‚